<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="churchTemp">
	<insert id="createChurchTemp" parameterType="hashmap">
		INSERT INTO church_temp (application_form_id, church_id, name, city, district, zip_code, addr1, addr2, writer_name, pastor, phone, email, status)
		VALUES (#{application_form_id}, #{church_id}, #{name}, #{city}, #{district}, #{zip_code}, #{addr1}, #{addr2}, #{writer_name}, #{pastor}, #{phone}, #{email}, 0)
	</insert>
	<update id="confirmChurchTemp">
		UPDATE church_temp SET status=1
		WHERE id=#{id}
	</update>
	<update id="rejectChurchTemp">
		UPDATE church_temp SET status=-1
		WHERE id=#{id}
	</update>
	<select id="readChurchTempById" resultType="edu.handong.walab.model.domain.ChurchTemp">
		SELECT * FROM church_temp
		WHERE id=#{id}
	</select>
	<select id ="readAllChurchTempData" parameterType="hashmap" resultType="edu.handong.walab.model.dto.compareChurchWithTemp">
		SELECT 
		application_form.id as application_form_id, application_form.admin_name, application_form.admin_phone, application_form.reg_date,
		church.id as church_id, church.denomination, church.name, church.city, church.district, church.zip_code, church.addr1, church.addr2, church.pastor, church.phone, church.email,
		church_temp.id as id, church_temp.name as new_name, church_temp.writer_name, church_temp.city as new_city , church_temp.district as new_district, church_temp.zip_code as new_zip_code, church_temp.addr1 as new_addr1, church_temp.addr2 as new_addr2, church_temp.pastor AS new_pastor, church_temp.phone AS new_phone, church_temp.email AS new_email, church_temp.status
		FROM `church_temp` 
		LEFT JOIN church
		ON church.id = church_temp.church_id
		JOIN application_form 
		ON church_temp.application_form_id = application_form.id
		WHERE church_temp.status != -1
		<if test="keyword != null">
			AND application_form.admin_name like #{keyword}
			OR application_form.admin_phone like #{keyword}
			OR church.denomination like #{keyword}
			OR church_temp.name like #{keyword}
			OR church_temp.city like #{keyword}
			OR church_temp.district like #{keyword}
			OR church_temp.addr1 like #{keyword}
			OR church_temp.addr2 like #{keyword}
			OR church.name like #{keyword}
			OR church.city like #{keyword}
			OR church.district like #{keyword}
		</if>
	</select>
	<delete id="delete" parameterType="hashmap">
		DELETE FROM church_temp
		WHERE id=#{application_form_id}
	</delete>
</mapper>